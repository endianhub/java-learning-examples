## 多线程创建和停止

### 本节内容

1. 什么是进程、线程
2. 多线程有那些好处
3. 多线程的应用场景有那些
4. 如何理解多线程上下文切换
5. 使用多线程存在那些缺陷
6. 多线程四种创建的方式 
7. 创建带返回结果的线程
8. 多线程五种状态有那些
9. 如何优雅的停止一个线程


<br>


#### 什么是进程

进程就是系统中正在运行的一个程序，程序一旦运行就是一个进程，在一个进程中可以开启多个不同的线程执行。

<br>

#### 什么是多线程

在同一个进程开启了多条不同的执行路径，每条执行路径就是一个线程，多条不同路径同时执行。

<br>

#### 使用多线程的好处

1. 使用多线程可以提高程序效率
2. 快速响应给客户端，给用户更加好的体验
3. 每个线程之间相互不影响

<br>

#### 使用多线程的应用场景

1. 使用多线程实现异步发送短信
2. 使用多线程实现异步的记录日志
3. 使用多线程处理一些比较耗时间的业务逻辑

<br>

#### 单线程与多线程之间的区别

单线程：就是使用一条线程从上到下执行完代码，效率比较低，且响应也比较慢，对用户不是很友好。

多线程：开启多条不同的线程，每个线程执行不同的任务，每个线程之间相互不影响。

<br>

#### 如何理解线程上下文切换

对于单核的CPU来说，CPU在同一个时刻只能够运行一个线程，当正在运行的线程切换到另外一个线程时，这个过程我们可以理解为CPU上下文切换。

如果是多核处理器，比如我的上课电脑 I7 8700k 6核 12线程，也就是在同一个时刻可以开启12个线程同时运行，服务器支持的线程数越高可以减少CPU上下文的切换，从而提高效率。

所以注意：单核的服务器开启了多线程，人为感知好像是多线程，但是真正意义上的底层不是多线程。

<br>

> 使用多线程真的开启越多越好吗？

如果项目比较小的情况下可以采用多线程异步实现处理是可以的，但是如果在高并发的情况下频繁的创建线程，同时也会被CPU分配调度，不断的切换，对服务器影响也是比较大，所以建议如果是在高并发的情况下采用MQ异步的形式替代多线程。

<br>

#### 多线程四种创建的方式

1. 继承Thread类
2. 使用Runnable
3. 使用Callable
4. 线程池的方式

<br>

#### 多线程五种的状态

1. 当我们新建一个线程的时候，new Thread的时候为新建的状态。
2. 当我们调用到start方法的时候，不会立马执行到我们的run方法，当前线程状态为就绪状态，需要等待cpu的切换。
3. 当cpu切换能够调用到该线程的时候，当前线程的状态为运行状态。
4. 当我们在线程调用sleep方法的时候，当前线程线程的状态为阻塞状态，当休眠的时候过了的时候有需要从新等待cpu调度，从就绪状态到运行。
5. 当我们线程调用stop方法或者run方法代码执行结束的时候当前线程的状态为死亡状态。


<br>

#### 如何优雅的停止一个线程	

官方不建议直接调用stop方法停止该线程，建议采用 中间件变量值的停止该线程。


> 因为在绝大多数的情况下 异步是不需要返回结果


<br>

### 本节用例

1. 使用Thread类创建线程
2. 使用Runnable接口创建线程
3. 使用Callable接口创建待返回值的线程
4. 使用线程池的方式创建线程

<br>


### 注意

**Java 默认创建的线程都是用户线程**

1. thread.setDaemon(false) 用户线程

2. thread.setDaemon(true) 守护线程