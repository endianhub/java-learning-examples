## CGLIB 动态代理

### 本节内容：

1. 基于 CGLIB 实现动态代理
2. CGLIB 底层原理
3. CGLIB 与 JDK 动态代理区别
4. CGLIB 的 FastClass 机制实现原理

<br>

### 本节用例：

1. CGLIB 动态代理实现
2. CGLIB 动态代理源码分析

<br>

### 难点解析

1、JDK 与 CGLIB 动态代理区别：

- JDK动态代理是基于接口实现代理的模式，走的是回调拦截，需要通过反射技术执行目标方法；

> JDK 动态代理实现流程:
>- 拼接 java 源代码
>- 编译为class文件
>- 读取去class文件到内存中

- CGLIB 动态代理采用继承的模式生成代理类，底层基于Asm字节码技术实现生成代理类；

> CGLIB 动态代理实现流程:
>- 生成class文件
>- 读取去class文件到内存中

CGLIB 动态代理采用 FastClass 索引的机制执行我们的目标方法，因此 CGLIB 的效率比 JDK 动态代理效率要高。


2、Spring 中是如何综合使用 CGLIB 和 JDK 动态代理呢

- 如果被代理类有实现接口的情况下默认采用 JDK 动态代理
- 如果被代理类没有实现接口的情况下采用 CGLIB 动态代理


3、CGLIB 的 FastClass 机制实现原理

- Fastclass 索引机制对我们目标方法加上索引；
- Fastclass原理：使用字节码技术获取当前所有的方法，对每个方法加上一个索引，直接根据索引调用到目标方法效率是比反射机制要高。使用方法名称 + 参数类型的形式计算 hash 值，再根据 hash 值得出索引。

